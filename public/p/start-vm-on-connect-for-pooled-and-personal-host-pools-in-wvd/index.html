<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="This announcement of Eva Seydl, Program Manager at Microsoft, made my week! Start VM on Connect, a feature well known to most of the WVD rockstars as a solution to start virtual machines in Personal Host Pool scenarios is now also available for Pooled Host Pools. In this blog you will learn, how to configure Start VM on Connect for Pooled Host Pools, Personal Host Pools and how to shut down VMs, when the users are logging off.">
<title>Start VM on Connect for Pooled and Personal Host Pools in WVD</title>

<link rel='canonical' href='https://patrick-koehler.com/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/'>

<link rel="stylesheet" href="/scss/style.min.e733519129d2cfe1ba92a4207e21f074c2efb106e22901c6ad0c4a4972161dd0.css"><meta property='og:title' content="Start VM on Connect for Pooled and Personal Host Pools in WVD">
<meta property='og:description' content="This announcement of Eva Seydl, Program Manager at Microsoft, made my week! Start VM on Connect, a feature well known to most of the WVD rockstars as a solution to start virtual machines in Personal Host Pool scenarios is now also available for Pooled Host Pools. In this blog you will learn, how to configure Start VM on Connect for Pooled Host Pools, Personal Host Pools and how to shut down VMs, when the users are logging off.">
<meta property='og:url' content='https://patrick-koehler.com/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/'>
<meta property='og:site_name' content='Patrick&#39;s Multi-Cloud Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Windows 365' /><meta property='article:tag' content='Azure Virtual Desktop' /><meta property='article:tag' content='Microsoft Intune' /><meta property='article:tag' content='Azure' /><meta property='article:tag' content='Windows 11' /><meta property='article:tag' content='Windows 10' /><meta property='article:published_time' content='2021-07-29T16:56:47&#43;06:00'/><meta property='article:modified_time' content='2021-07-29T16:56:47&#43;06:00'/><meta property='og:image' content='https://patrick-koehler.com/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/title.png' />
<meta name="twitter:site" content="@wvdlogix">
    <meta name="twitter:creator" content="@wvdlogix"><meta name="twitter:title" content="Start VM on Connect for Pooled and Personal Host Pools in WVD">
<meta name="twitter:description" content="This announcement of Eva Seydl, Program Manager at Microsoft, made my week! Start VM on Connect, a feature well known to most of the WVD rockstars as a solution to start virtual machines in Personal Host Pool scenarios is now also available for Pooled Host Pools. In this blog you will learn, how to configure Start VM on Connect for Pooled Host Pools, Personal Host Pools and how to shut down VMs, when the users are logging off."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://patrick-koehler.com/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/title.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huc59d5fe30e8b430128cebedffe7532de_4365636_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Patrick&#39;s Multi-Cloud Blog</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/patrick-koehler/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" /><path d="M8 11l0 5" /><path d="M8 8l0 .01" /><path d="M12 16l0 -5" /><path d="M16 16v-3a2 2 0 0 0 -4 0" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/wvdlogix'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.strava.com/athletes/117484839'
                        target="_blank"
                        title="Strava"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-strava"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 13l-5 -10l-5 10m6 0l4 8l4 -8" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/pkoehlercloud'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/about-patrick/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Patrick</span>
            </a>
        </li>
        
        
        <li >
            <a href='/cycling/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-bike"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M19 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M12 19l0 -4l-3 -3l5 -4l2 3l3 0" /><path d="M17 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>
                
                <span>Cycling</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#how-to-create-the-custom-role">How to create the custom role</a></li>
    <li><a href="#enable-start-vm-on-connect-for-pooled-host-pools">Enable “Start VM on Connect for Pooled Host Pools“</a></li>
    <li><a href="#turn-on-the-feature-for-a-single-pooled-hostpool">Turn on the feature for a single pooled HostPool</a></li>
    <li><a href="#turn-on-the-feature-for-all-pooled-hostpools">Turn on the feature for ALL pooled HostPools</a></li>
    <li><a href="#turn-off-the-feature-for-a-single-pooled-hostpool">Turn off the feature for a single Pooled HostPool</a></li>
    <li><a href="#turn-off-the-feature-for-all-pooled-hostpools">Turn off the feature for all Pooled HostPools</a></li>
    <li><a href="#enable-start-vm-on-connect-for-personal-host-pools">Enable “Start VM on Connect for Personal Host Pools“</a></li>
    <li><a href="#enable-the-feature-for-a-single-personal-host-pool-azure-portal">Enable the feature for a single Personal Host Pool (Azure Portal)</a></li>
    <li><a href="#enable-the-feature-for-all-personal-host-pools-powershell">Enable the feature for all Personal Host Pools (PowerShell)</a></li>
    <li><a href="#disable-the-feature-for-personal-host-pools-azure-portal">Disable the feature for Personal Host Pools (Azure Portal)</a></li>
    <li><a href="#disable-the-feature-for-all-personal-host-pools-powershell">Disable the feature for all Personal Host Pools (PowerShell)</a></li>
    <li><a href="#enable-shutdown-virtual-machines-at-logoff">Enable “Shutdown virtual machines at LogOff“</a></li>
    <li><a href="#shutting-down-pooled-session-hosts">Shutting down Pooled Session Hosts</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/">
                <img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/title_hu47f31a060c17741ed671fdc891fc1e2a_106079_800x0_resize_box_3.png"
                        srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/title_hu47f31a060c17741ed671fdc891fc1e2a_106079_800x0_resize_box_3.png 800w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/title_hu47f31a060c17741ed671fdc891fc1e2a_106079_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="457" 
                        loading="lazy"
                        alt="Featured image of post Start VM on Connect for Pooled and Personal Host Pools in WVD" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/azure-virtual-desktop/" style="background-color: #2a9d8f; color: #fff;">
                Azure Virtual Desktop
            </a>
        
            <a href="/categories/fslogix/" style="background-color: #2a9d8f; color: #fff;">
                FSLogix
            </a>
        
            <a href="/categories/microsoft-azure/" style="background-color: #2a9d8f; color: #fff;">
                Microsoft Azure
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/">Start VM on Connect for Pooled and Personal Host Pools in WVD</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 29, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    10 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>This announcement of Eva Seydl, Program Manager at Microsoft, made my week! Start VM on Connect, a feature well known to most of the WVD rockstars as a solution to start virtual machines in Personal Host Pool scenarios is now also available for Pooled Host Pools.</p>
<p>In this blog you will learn, how to configure Start VM on Connect for Pooled Host Pools, Personal Host Pools and how to shut down VMs, when the users are logging off.</p>
<h2 id="prerequisites">
    <a href="#prerequisites" class="header-anchor">#</a>
    Prerequisites
</h2><p>If you want to get started with Start VM on Connect in general you need to know a few things about it. It’s a feature that allows you to start virtual machines, but not yet to stop and deallocate them!</p>
<p>Additionally, it’s important to mention, that the feature supports ony the following Remote Desktop Clients:</p>
<p>The WVD web client: (<a class="link" href="https://rdweb.wvd.microsoft.com/arm/webclient"  target="_blank" rel="noopener"
    >https://rdweb.wvd.microsoft.com/arm/webclient</a>)
The Windows client (from version: 1.2748 or later) – Connect to Windows Virtual Desktop Windows 10 or 7 – Azure | Microsoft Docs
Android client (from version 10.0.10 or later) – (<a class="link" href="https://play.google.com/store/apps/details?id=com.microsoft.rdc.androidx"  target="_blank" rel="noopener"
    >https://play.google.com/store/apps/details?id=com.microsoft.rdc.androidx</a>)
macOS client (from version 10.6.4 or later) – (<a class="link" href="https://apps.apple.com/app/microsoft-remote-desktop/id1295203466?mt=12"  target="_blank" rel="noopener"
    >https://apps.apple.com/app/microsoft-remote-desktop/id1295203466?mt=12</a>)
The iOS client is currently NOT supported! Updates can happen at any time to change this.</p>
<p>To make the feature work in your environment, the second prerequisite is to create a custom role for Start VM on Connect. This can be achieved by granting access to the following set of permissions:</p>
<ul>
<li>Microsoft.Compute/virtualMachines/start/action</li>
<li>Microsoft.Compute/virtualMachines/read</li>
</ul>
<h2 id="how-to-create-the-custom-role">
    <a href="#how-to-create-the-custom-role" class="header-anchor">#</a>
    How to create the custom role
</h2><p>First, you have to open your subscription from the Azure Portal. Click on Access control (IAM) to create a custom role.</p>
<p>In the top center of the screen click on “+Add” to create the new role and select “Add custom role”.</p>
<p>Now you have to give your role a name. I’ve chosen: “WVD Start VM on Connect”, which allows me to identify the role I need easily. Give your new role a description to understand easily, what this role is for, and click on Permissions.</p>
<p>Now click on “+Add permissions” and select the permissions you want to grant for this role. Like mentioned above you need:</p>
<ul>
<li>Microsoft.Compute/virtualMachines/start/action</li>
<li>Microsoft.Compute/virtualMachines/read</li>
</ul>
<p>Alternatively, import the following JSON file for your role:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;roleName&#34;</span><span class="p">:</span> <span class="s2">&#34;WVDStartVMonConnect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Custom role for starting VMs for WVD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;assignableScopes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;/subscriptions/4faae4e2-2c28-4b36-9002-31ad17a4ded4&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;permissions&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;actions&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;Microsoft.Compute/virtualMachines/read&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;Microsoft.Compute/virtualMachines/start/action&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;notActions&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;dataActions&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;notDataActions&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, click Review + create and confirm another time by clicking “create“.</p>
<p>Once the task is completed, you will get the following notification.</p>
<p>As the role is created, you need to assign this custom role to the WVD service. This can be achieved by clicking on “Role assignments” in your subscription, followed by clicking “+Add” &gt; “Add role assignment“.</p>
<p>Now you just need to pick the recently created role, which is WVDStartVMOnConnect in my case, and assign access to Windows Virtual Desktop as a service. Once this is done, the role assignment completed successfully.</p>
<h2 id="enable-start-vm-on-connect-for-pooled-host-pools">
    <a href="#enable-start-vm-on-connect-for-pooled-host-pools" class="header-anchor">#</a>
    Enable “Start VM on Connect for Pooled Host Pools“
</h2><p>On 12 May, Eva Seydl, Program Manager at Microsoft announced the availability of Start VM on Connect for Pooled Host Pools! This is awesome news, because it allows the first user connecting to a turned off Session Host to turn it on an allows an even more flexible way of scaling. Additionally, it allows you to scale down your Virtual Machines to ZERO, which is a huge cost saving opportunity for your environments.</p>
<p>The following describes the way to configure Start VM on Connect for Pooled Host Pools.</p>
<p>The important thing you need to know is, that this feature is currently in Preview. For that reason there is no graphical button to turn this feature on and it actually requires PowerShell.</p>
<p>Now log on to your Azure account with administrative privileges for WVD. Additionally make sure you have the Az.DesktopVirtualization module installed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Connect-AzAccount</span>
</span></span><span class="line"><span class="cl"><span class="nb">Import-Module</span> <span class="n">Az</span><span class="p">.</span><span class="py">DesktopVirtualization</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now you need to identify the Pooled Host Pools in your environment, you can achieve this by the following line of code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-AzWvdHostPool</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">HostPoolType</span> <span class="o">-eq</span> <span class="s2">&#34;Pooled&#34;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="turn-on-the-feature-for-a-single-pooled-hostpool">
    <a href="#turn-on-the-feature-for-a-single-pooled-hostpool" class="header-anchor">#</a>
    Turn on the feature for a single pooled HostPool
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Update-AzWvdHostPool</span> <span class="n">-ResourceGroupName</span> <span class="p">&lt;</span><span class="n">resourcegroupname</span><span class="p">&gt;</span> <span class="n">-Name</span> <span class="p">&lt;</span><span class="n">hostpoolname</span><span class="p">&gt;</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="turn-on-the-feature-for-all-pooled-hostpools">
    <a href="#turn-on-the-feature-for-all-pooled-hostpools" class="header-anchor">#</a>
    Turn on the feature for ALL pooled HostPools
</h2><p>Information: Make sure you’re in the correct AZ Context in case you’re handling multiple subscriptions in your environment. Usage and more information can be found here: (<a class="link" href="https://web.archive.org/web/20230326143059/https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax"  target="_blank" rel="noopener"
    >https://web.archive.org/web/20230326143059/https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Connect-AzAccount</span>
</span></span><span class="line"><span class="cl"><span class="nv">$AllHostPools</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="n">ResourceType</span> <span class="o">-eq</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">DesktopVirtualization</span><span class="p">/</span><span class="n">hostpools</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$HostPool</span> <span class="k">in</span> <span class="nv">$AllHostPools</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$HostPoolValidation</span> <span class="p">=</span> <span class="nb">Get-AzWVDHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">HostPoolType</span> <span class="o">-eq</span> <span class="s2">&#34;Pooled&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">StartVMOnConnect</span> <span class="o">-eq</span> <span class="vm">$true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Write-Host</span> <span class="s2">&#34;The HostPool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34; has the feature already enabled. Continue with the next one&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Update-AzWvdHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroup</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Write-Host</span> <span class="s2">&#34;Start VM on Connect has been successfully configured for Host Pool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34;&#34;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="turn-off-the-feature-for-a-single-pooled-hostpool">
    <a href="#turn-off-the-feature-for-a-single-pooled-hostpool" class="header-anchor">#</a>
    Turn off the feature for a single Pooled HostPool
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Update-AzWvdHostPool</span> <span class="n">-ResourceGroupName</span> <span class="p">&lt;</span><span class="n">resourcegroupname</span><span class="p">&gt;</span> <span class="n">-Name</span> <span class="p">&lt;</span><span class="n">hostpoolname</span><span class="p">&gt;</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="turn-off-the-feature-for-all-pooled-hostpools">
    <a href="#turn-off-the-feature-for-all-pooled-hostpools" class="header-anchor">#</a>
    Turn off the feature for all Pooled HostPools
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Connect-AzAccount</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$AllHostPools</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="n">ResourceType</span> <span class="o">-eq</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">DesktopVirtualization</span><span class="p">/</span><span class="n">hostpools</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$HostPool</span> <span class="k">in</span> <span class="nv">$AllHostPools</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="nv">$HostPoolValidation</span> <span class="p">=</span> <span class="nb">Get-AzWVDHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">HostPoolType</span> <span class="o">-eq</span> <span class="s2">&#34;Pooled&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">StartVMOnConnect</span> <span class="o">-eq</span> <span class="vm">$false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="nb">Write-Host</span> <span class="s2">&#34;The HostPool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34; has the feature already enabled. Continue with the next one&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Update-AzWvdHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroup</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Write-Host</span> <span class="s2">&#34;Start VM on Connect has been successfully deactivated for Host Pool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34;&#34;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="enable-start-vm-on-connect-for-personal-host-pools">
    <a href="#enable-start-vm-on-connect-for-personal-host-pools" class="header-anchor">#</a>
    Enable “Start VM on Connect for Personal Host Pools“
</h2><p>If you want to enable Start VM on Connect for Personal Host Pools, that’s also not a problem and can easily be achieved by using the Azure Portal. If you wish to do this by PowerShell, this can also be achieved and will be explained in the following subchapters.</p>
<h2 id="enable-the-feature-for-a-single-personal-host-pool-azure-portal">
    <a href="#enable-the-feature-for-a-single-personal-host-pool-azure-portal" class="header-anchor">#</a>
    Enable the feature for a single Personal Host Pool (Azure Portal)
</h2><p>The easiest possibility of managing the Start VM on Connect feature is currently (last reviewed 18.05.2021) the Azure Portal. Where it’s not possible to achieve this for Pooled Host Pools, the Microsoft Product Group enabled this feature already for the Personal Host Pools.</p>
<p>All you need to do is to log into the Azure Portal using: <a class="link" href="https://portal.azure.com"  target="_blank" rel="noopener"
    >https://portal.azure.com</a> and navigate to the Windows Virtual Desktop Service. Arrived in the Host Pool overview, you will find the Pooled and Personal Host Pool types. We select the Personal Host Pool we want to enable to continue. Now we need to select Properties to find this option.</p>
<p>As a last step, you only need to enable the “Start VM on Connect” feature, while hitting Yes and clicking on “Save” in the upper corner. That’s it!</p>
<h2 id="enable-the-feature-for-all-personal-host-pools-powershell">
    <a href="#enable-the-feature-for-all-personal-host-pools-powershell" class="header-anchor">#</a>
    Enable the feature for all Personal Host Pools (PowerShell)
</h2><p>If you want to enable the feature for all Personal Host Pools, we need to use the PowerShell again. Please use the following script to allow all Personal Host Pools for Start VM on Connect.</p>
<p>Information: Make sure you’re in the correct AZ Context in case you’re handling multiple subscriptions in your environment. Usage and more information can be found here: (<a class="link" href="https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax"  target="_blank" rel="noopener"
    >https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Connect-AzAccount</span>
</span></span><span class="line"><span class="cl"><span class="nv">$AllHostPools</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="n">ResourceType</span> <span class="o">-eq</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">DesktopVirtualization</span><span class="p">/</span><span class="n">hostpools</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$HostPool</span> <span class="k">in</span> <span class="nv">$AllHostPools</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="nv">$HostPoolValidation</span> <span class="p">=</span> <span class="nb">Get-AzWVDHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">HostPoolType</span> <span class="o">-eq</span> <span class="s2">&#34;Personal&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">StartVMOnConnect</span> <span class="o">-eq</span> <span class="vm">$true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="nb">Write-Host</span> <span class="s2">&#34;The HostPool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34; has the feature already enabled. Continue with the next one&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Update-AzWvdHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroup</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$true</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Write-Host</span> <span class="s2">&#34;Start VM on Connect has been successfully configured for Host Pool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34;&#34;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="disable-the-feature-for-personal-host-pools-azure-portal">
    <a href="#disable-the-feature-for-personal-host-pools-azure-portal" class="header-anchor">#</a>
    Disable the feature for Personal Host Pools (Azure Portal)
</h2><p>Disabling the feature for a single Personal Host Pool, is as simple as enabling it. Just follow the steps from the previous subchapter and select “No” in the option field from within the Host Pool property page.</p>
<h2 id="disable-the-feature-for-all-personal-host-pools-powershell">
    <a href="#disable-the-feature-for-all-personal-host-pools-powershell" class="header-anchor">#</a>
    Disable the feature for all Personal Host Pools (PowerShell)
</h2><p>If you want to disable the feature for all Personal Host Pools, please use the following script. Information: Make sure you’re in the correct AZ Context in case you’re handling multiple subscriptions in your environment. Usage and more information can be found here: (<a class="link" href="https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax"  target="_blank" rel="noopener"
    >https://docs.microsoft.com/en-us/powershell/module/az.accounts/set-azcontext?view=azps-5.9.0#syntax</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Connect-AzAccount</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$AllHostPools</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="n">ResourceType</span> <span class="o">-eq</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">DesktopVirtualization</span><span class="p">/</span><span class="n">hostpools</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$HostPool</span> <span class="k">in</span> <span class="nv">$AllHostPools</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$HostPoolValidation</span> <span class="p">=</span> <span class="nb">Get-AzWVDHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">HostPoolType</span> <span class="o">-eq</span> <span class="s2">&#34;Personal&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="py">StartVMOnConnect</span> <span class="o">-eq</span> <span class="vm">$false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Write-Host</span> <span class="s2">&#34;The HostPool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34; has the feature already enabled. Continue with the next one&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Update-AzWvdHostPool</span> <span class="n">-Name</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">Name</span> <span class="n">-ResourceGroup</span> <span class="nv">$HostPool</span><span class="p">.</span><span class="py">ResourceGroupName</span> <span class="n">-StartVMOnConnect:</span><span class="vm">$false</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">Write-Host</span> <span class="s2">&#34;Start VM on Connect has been successfully deactivated for Host Pool &#34;</span><span class="nv">$HostPoolValidation</span><span class="p">.</span><span class="n">Name</span><span class="s2">&#34;&#34;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="enable-shutdown-virtual-machines-at-logoff">
    <a href="#enable-shutdown-virtual-machines-at-logoff" class="header-anchor">#</a>
    Enable “Shutdown virtual machines at LogOff“
</h2><p>A few weeks ago, Microsoft Global Black Belt Bernd Löhlein blogged about shutting down the Session Hosts and deallocating them, to not consume more money from your subscription, when the users log off. The solution is great for Personal Host Pools, but shouldn’t be used with Pooled Host Pools, as there might be more people working on the Session Host concurrently. Please find Bernd’s blog here: (<a class="link" href="https://techcommunity.microsoft.com/t5/windows-virtual-desktop/deallocate-vm-on-user-logoff/m-p/2280211"  target="_blank" rel="noopener"
    >https://techcommunity.microsoft.com/t5/windows-virtual-desktop/deallocate-vm-on-user-logoff/m-p/2280211</a>)</p>
<h2 id="shutting-down-pooled-session-hosts">
    <a href="#shutting-down-pooled-session-hosts" class="header-anchor">#</a>
    Shutting down Pooled Session Hosts
</h2><p>To achieve this we have two possibilities:</p>
<ul>
<li>Shutting down the virtual machines based on a time based metric</li>
<li>Using the WVDLogix Autoscale Tool to scale down machines</li>
</ul>
<p>To shut down the VMs based on a time based metric, we need to create an Automation Account in our subscription.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image.png"
	width="682"
	height="342"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image_hu053f6ecd58df2510c95ac837fcb6de50_88227_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image_hu053f6ecd58df2510c95ac837fcb6de50_88227_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="199"
		data-flex-basis="478px"
	
></p>
<p>On the next page, we´ll give our Automation Account a name, select the subscription, the RG we´ve created, and the operating location, which is West Europe in my case. You also have the possibility to create a RunAs Account, which is not needed for the solution, which we´re going to provision right afterwards. Hit “Create” once you´re finished.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-1.png"
	width="371"
	height="1024"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-1_hu9ec759cac849b289ce22d31f9c047f14_258271_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-1_hu9ec759cac849b289ce22d31f9c047f14_258271_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="36"
		data-flex-basis="86px"
	
></p>
<p>After a few seconds, our storage account is ready to be used and we can go to the resource, which presents us the basic overview of an Automation account.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-2.png"
	width="1024"
	height="823"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-2_hu2fb28a82cb71bb555a297d41dda1e6f2_466115_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-2_hu2fb28a82cb71bb555a297d41dda1e6f2_466115_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="124"
		data-flex-basis="298px"
	
></p>
<p>In here, we need to scroll down on the left hend side until we reach “Start/Stop VM”, which is the solution we want to install.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-3.png"
	width="832"
	height="705"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-3_hud409c485d1e58c445ea7536ec39e4073_250570_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-3_hud409c485d1e58c445ea7536ec39e4073_250570_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="118"
		data-flex-basis="283px"
	
></p>
<p>It´s obvious that we´re going to click on “Create”, but I´m very excited to see, what you´re saying about what this solution delivers additionally, when correctly configured. For now we click “Create” again to provision the solution.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-4.png"
	width="823"
	height="317"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-4_hud5c1f4708f7a58db907aa91021ab34f9_105114_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-4_hud5c1f4708f7a58db907aa91021ab34f9_105114_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="623px"
	
></p>
<p>The agent will guide us through the deployment of the solution, which requires the following components:</p>
<ul>
<li>Log Analytics Workspace (Can be created from within the solution deployment)</li>
<li>Azure Automation Account (which has been created previously)</li>
<li>Parameters</li>
</ul>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-5.png"
	width="787"
	height="704"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-5_hu8172b88afe41ccb92eb176903ffdcd0b_154315_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-5_hu8172b88afe41ccb92eb176903ffdcd0b_154315_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="111"
		data-flex-basis="268px"
	
></p>
<p>After you´ve created the Log Analytics Workspace and select the Automation Account created by us earlier, we leave the parameters empty for the moment. To not hide the possibilities from you, here is the screenshot of the initial configuration, to be defined from over here already.</p>
<p><img src="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-6.png"
	width="773"
	height="733"
	srcset="/p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-6_hu1cd23b2dfdb2e5df852f9c186dfa1331_197962_480x0_resize_box_3.png 480w, /p/start-vm-on-connect-for-pooled-and-personal-host-pools-in-wvd/image-6_hu1cd23b2dfdb2e5df852f9c186dfa1331_197962_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="alt text"
	
	
		class="gallery-image" 
		data-flex-grow="105"
		data-flex-basis="253px"
	
></p>
<p>As mentioned before, we keep it empty and hit “OK” and click “Create”.</p>
<p>The deployment process is going to start and will finalize between 10-15 minutes and this will shutdown all machines, based on a time based metric automatically.</p>
<p><b> My personal recommendation is clearly to use the Autoscaling engine! </b></p>
<p>Thank you for reading this article!</p>
<p>Cheers,
Patrick</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/windows-365/">Windows 365</a>
        
            <a href="/tags/azure-virtual-desktop/">Azure Virtual Desktop</a>
        
            <a href="/tags/microsoft-intune/">Microsoft Intune</a>
        
            <a href="/tags/azure/">Azure</a>
        
            <a href="/tags/windows-11/">Windows 11</a>
        
            <a href="/tags/windows-10/">Windows 10</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/what-you-have-to-know-about-the-wvd-required-url-check-tool/">
        
        
            <div class="article-image">
                <img src="/p/what-you-have-to-know-about-the-wvd-required-url-check-tool/title.88515152412212926706d1e9d67726a1_hu47f31a060c17741ed671fdc891fc1e2a_68582_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post What you have to know about the WVD Required URL check tool"
                        
                        data-hash="md5-iFFRUkEiEpJnBtHp1ncmoQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">What you have to know about the WVD Required URL check tool</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/how-to-reset-the-remote-desktop-client-on-windows-10-11/">
        
        
            <div class="article-image">
                <img src="/p/how-to-reset-the-remote-desktop-client-on-windows-10-11/title.3d887d5b8567680066c722d4e44fd9d0_hu47f31a060c17741ed671fdc891fc1e2a_72005_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post How to reset the Remote Desktop Client on Windows 10 &amp; 11"
                        
                        data-hash="md5-PYh9W4VnaABmxyLU5E/Z0A==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">How to reset the Remote Desktop Client on Windows 10 &amp; 11</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/microsoft-edge-the-complete-guide-for-avd/">
        
        
            <div class="article-image">
                <img src="/p/microsoft-edge-the-complete-guide-for-avd/title.50e17fdf44d25cfeb7273ebb5233aac8_hu47f31a060c17741ed671fdc891fc1e2a_103632_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Microsoft Edge – The complete guide for AVD"
                        
                        data-hash="md5-UOF/30TSXP63Jz67UjOqyA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Microsoft Edge – The complete guide for AVD</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/container-up-your-applications-fast-secure-efficient-with-msix-app-attach/">
        
        
            <div class="article-image">
                <img src="/p/container-up-your-applications-fast-secure-efficient-with-msix-app-attach/title.05aa5e48f03fa0fa8d8a8eb8a92dee3e_hu47f31a060c17741ed671fdc891fc1e2a_65534_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Container up your applications: fast, secure &amp; efficient with MSIX App Attach"
                        
                        data-hash="md5-BapeSPA/oPqNio64qS3uPg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Container up your applications: fast, secure &amp; efficient with MSIX App Attach</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/fslogix-and-microsoft-365-apps-for-enterprise-activation-issue-remediation/">
        
        
            <div class="article-image">
                <img src="/p/fslogix-and-microsoft-365-apps-for-enterprise-activation-issue-remediation/title.c4f3951216853104fcde70afbab304f9_hu47f31a060c17741ed671fdc891fc1e2a_98805_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post FSLogix and Microsoft 365 Apps for Enterprise Activation issue remediation"
                        
                        data-hash="md5-xPOVEhaFMQT83nCvurME&#43;Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">FSLogix and Microsoft 365 Apps for Enterprise Activation issue remediation</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Patrick Köhler
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
